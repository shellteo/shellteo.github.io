---
layout: post
title:  "å®šåˆ¶è½®æ’­ç»„ä»¶"
date:   2019-07-19
categories: js
author: å¼ ç¿”
location: ShangHai, China
description: "è½®æ’­ç»„ä»¶"
---
---

è½®æ’­æ˜¯ä¸€ä¸ªå¾ˆå¤è€çš„è¯é¢˜äº†ï¼Œå¸‚é¢ä¸Šä¹Ÿæœ‰å¾ˆå¤šå¼€æºç»„ä»¶ï¼Œæˆ‘ä»¬éœ€è¦åšä¸€äº›å®šåˆ¶åŒ–çš„ï¼Œæ‰€ä»¥åªæœ‰è‡ªå·±åŠ¨æ‰‹åšä¸€ä¸ªç»„ä»¶ï¼Œæ•ˆæœå¦‚ä¸‹ ã€‚å¯ä»¥å®šåˆ¶è§†å£æ˜¾ç¤ºå¤šå°‘ä¸ªå›¾ç‰‡ï¼Œä»¥åŠå›¾ç‰‡çš„æ ·å¼å’Œæ•ˆæœã€‚

![gif](http://myblog-images1.oss-cn-beijing.aliyuncs.com/carousel/carousel.gif)

å…³äºå›¾ç‰‡è½®æ’­å’Œæ— é™è½®æ’­çš„åŸç†[è¿™ç¯‡æ–‡ç« ](https://juejin.im/post/5aaf0907f265da23870e9fed)æœ‰ä»‹ç»ã€‚

è½®æ’­æœ‰ä¸‰ä¸ªåŠ¨ä½œï¼Œç‚¹å‡»å‘å·¦æŒ‰é’®ã€ç‚¹å‡»å‘å³æŒ‰é’®ã€ç‚¹å‡»å›¾ç‰‡ã€‚
ä»£ç é‡Œé¢æœ‰ä¸€ä¸ªimgIdxï¼ˆå›¾ç‰‡ä½ç½®ï¼‰ã€displayIdxï¼ˆæ˜¾ç¤ºä½ç½®ï¼‰è¿™ä¸¤ä¸ªå˜é‡ã€‚
ç‚¹å‡»åœ¨çª—å£å†…éƒ¨çš„å›¾ç‰‡ï¼Œä¸éœ€è¦æ”¹å˜displayIdxï¼Œé¡µé¢æ»šåŠ¨åˆ°éœ€è¦æ”¹å˜displayIdxï¼Œè¿™å…¶å®å°±æ˜¯ä¸€ä¸ªæ»‘åŠ¨çª—å£ã€‚

imgIdxçš„èŒƒå›´æ˜¯0åˆ°avatar.length -1ã€‚
displayIdxçš„èŒƒå›´æ˜¯0åˆ°avatar.length - displayNumã€‚


### ç‚¹å‡»ğŸ‘ˆæŒ‰é’®
åªæœ‰imgIdxå¤§äº0çš„æƒ…å†µä¸‹ï¼ŒimgIdxå°±å‡ä¸€ã€‚
displayIdxä»£è¡¨çª—å£çš„ç§»åŠ¨ï¼Œæƒ…å†µè¦å¤æ‚ä¸€ç‚¹ï¼Œé¦–å…ˆdisplayIdxè¦åœ¨å–å€¼èŒƒå›´å‘¢ï¼Œå…¶æ¬¡imgIdx === displayIdxä¿è¯å½“å‰å–å€¼æ­£å¥½ä½äºä½ç½®çš„å·¦ä¾§ã€‚
```javascript
prev() {
  let { imgIdx, displayIdx } = this;
  if (displayIdx > 0 && imgIdx === displayIdx) this.displayIdx --;
  if (imgIdx > 0) {
    this.imgIdx --;
    this.$emit('prev', this.imgIdx);
  }
}
```
### ç‚¹å‡»ğŸ‘‰æŒ‰é’®
åªæœ‰imgIdxå°äºl - 1çš„æƒ…å†µä¸‹ï¼ŒimgIdxå°±åŠ 1ã€‚
 imgIdx === displayNum + displayIdx - 1ä¿è¯å½“å‰ä½ç½®æ­£å¥½ä½äºçª—å£çš„å³ä¾§ï¼Œå†å¾€å³ç§»åŠ¨ï¼Œå°±éœ€è¦ç§»åŠ¨çª—å£ã€‚
```javascript
next() {
  let { imgIdx, displayIdx, displayNum, avatar } = this;
  const l = avatar.length;
  if (displayIdx < l - displayNum && imgIdx === displayNum + displayIdx - 1) this.displayIdx ++;
  if (imgIdx < l - 1) {
    this.imgIdx ++;
    this.$emit('next', this.imgIdx);
  }
}
```

### æºç å¦‚ä¸‹

```html
<template>
    <div class="carousel">
        <button class="arrow" @click="prev" :disabled="imgIdx <= 0">
            <img src="@/assets/left.png" alt="left">
        </button>
        <div class="carousel-window" :style="`width: ${displayNum * imgWidth}px`">
            <div class="carousel-container" :style="containerStyle">
                <div v-for="(item, i) in avatar" :class="['carousel-item', {'active': imgIdx === i}]" :key="i" :style="`transform: translateX(${i * imgWidth}px) scale(1);`" @click="move(i)">
                    <img :src="item.src" alt="">
                </div>
            </div>
        </div>
        <button class="arrow" @click="next" :disabled="imgIdx >= avatar.length - 1">
            <img src="@/assets/right.png" alt="right">
        </button>
    </div>
</template>
```

```javascript
export default {
    name: 'Carousel',
    props: {
      avatar: {
        type: Array,
        default: () => []
      }
    },
    data () {
      return {
        imgWidth: 100, // å›¾ç‰‡å¤§å°
        imgIdx: 0, // å›¾ç‰‡ä½ç½®
        displayIdx: 0, // æ˜¾ç¤ºä½ç½®
        displayNum: 4, // æ˜¾ç¤ºå‡ å¼ å›¾ç‰‡
      }
    },
    computed: { 
        //è¿™é‡Œç”¨äº†è®¡ç®—å±æ€§ï¼Œç”¨transformæ¥ç§»åŠ¨æ•´ä¸ªå›¾ç‰‡åˆ—è¡¨
      containerStyle() { 
        return {
          transform:`translate3d(-${this.displayIdx * this.imgWidth}px, 0, 0)`
        }
      }
    },
    methods: {
      prev() {
        let { imgIdx, displayIdx } = this;
        if (displayIdx > 0 && imgIdx === displayIdx) this.displayIdx --;
        if (imgIdx > 0) {
          this.imgIdx --;
          this.$emit('prev', this.imgIdx);
        }
      },
      next() {
        let { imgIdx, displayIdx, displayNum, avatar } = this;
        const l = avatar.length;
        if (displayIdx < l - displayNum && imgIdx === displayNum + displayIdx - 1) this.displayIdx ++;
        if (imgIdx < l - 1) {
          this.imgIdx ++;
          this.$emit('next', this.imgIdx);
        }
      },
      move(i) {
        this.imgIdx = i;
        this.$emit('move', i)
      }
    }
  }
```
```css
<style lang="less" scoped>
    .arrow {
        border: none;
        outline: none;
        padding: 0;
        margin: 0 10px;
        cursor: pointer;
        background-color: transparent;
    }
    .arrow img {
        width: 20px;
    }
    .arrow:disabled {
        opacity: 0.4;
        cursor: not-allowed;
    }
    .carousel {
        overflow-x: hidden;
        position: relative;
        display: flex;
        align-items: center;
    }
    .carousel-window {
        overflow: hidden;
    }
    .carousel-container {
        text-align: center;
        height: 120px;
        transition: all 100ms ease-in;
        width: auto;
        position: relative;
        .carousel-item {
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100px;
            height: 100px;
            display: inline-block;
            overflow: hidden;
            z-index: 0;
            cursor: pointer;
            img {
                width: 70px;
                height: 70px;
                border-radius: 50%;
                border: 6px solid #BBFAF9;
                opacity: 0.5;
            }
            &:hover:not(.active) {
                img {
                    border-color: #BBFAF9;
                    opacity: 1;
                }
            }
        }
        .active {
            img {
                border-color: #555;
                opacity: 1;
            }
        }
    }
</style>

```